<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Genetic diffusion and community detections • bixverse</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="genetic_diffusions_files/libs/quarto-html/popper.min.js"></script><script src="genetic_diffusions_files/libs/quarto-html/tippy.umd.min.js"></script><link href="genetic_diffusions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="genetic_diffusions_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Genetic diffusion and community detections">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bixverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Genetic diffusion and community detections</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="genetic-diffusion-and-community-detections">Genetic diffusion and community detections<a class="anchor" aria-label="anchor" href="#genetic-diffusion-and-community-detections"></a>
</h2>
<p>This vignette shows how to leverage networks to “diffuse” genetic information (to note, this could be any other type of seeding information) over these to create ranks of genes based on “diffusion heat”, calculate the predictive power of these genes against some gold standard genes, and also generate communities within the networks of “genetically privileged” mechanisms. The functions in the package have been inspired by work from <a href="https://pubmed.ncbi.nlm.nih.gov/31253980/" class="external-link">Fang et al.</a>, <a href="https://pubmed.ncbi.nlm.nih.gov/23986566/" class="external-link">Paull et al.</a>, <a href="https://pubmed.ncbi.nlm.nih.gov/36823319/" class="external-link">Barrio-Hernandez et al.</a>, and <a href="https://www.nature.com/articles/s41596-022-00797-1" class="external-link">Rosenthal et al.</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bixverse</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level3"><h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>To exemplify the functions here, we will be using synthetic data, but you can easily adopt the workflow with any sets of seed genes and networks. We will create a barabasi graph of 100 nodes as an undirected network. Most biological networks follow a scale-free topology. For the seed genes, we will be sampling two sets based on the node degree distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_nodes</span> <span class="op">&lt;-</span> <span class="fl">100L</span></span>
<span></span>
<span><span class="va">barabasi_graph</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/sample_pa.html" class="external-link">sample_pa</a></span><span class="op">(</span><span class="va">no_nodes</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">node_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"genes%i"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">no_nodes</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">node_names</span></span>
<span></span>
<span><span class="co"># The classes expects a data.table representing the edges</span></span>
<span><span class="co"># Weighted and directed graphs are supported</span></span>
<span><span class="va">edge_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/graph_from_data_frame.html" class="external-link">as_data_frame</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We will be creating two diffusion vectors based on the degree distribution</span></span>
<span><span class="co"># and one set of gold standard genes</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">genes_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span><span class="op">$</span><span class="va">name</span>, </span>
<span>  size <span class="op">=</span> <span class="fl">5</span>, </span>
<span>  prob <span class="op">=</span> <span class="va">probs</span></span>
<span><span class="op">)</span></span>
<span><span class="va">genes_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span><span class="op">$</span><span class="va">name</span>, </span>
<span>  size <span class="op">=</span> <span class="fl">8</span>, </span>
<span>  prob <span class="op">=</span> <span class="va">probs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">diffusion_vector_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">`names&lt;-`</span><span class="op">(</span><span class="va">genes_1</span><span class="op">)</span></span>
<span><span class="va">diffusion_vector_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">`names&lt;-`</span><span class="op">(</span><span class="va">genes_2</span><span class="op">)</span></span>
<span><span class="va">gold_standard_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">barabasi_graph</span><span class="op">)</span><span class="op">$</span><span class="va">name</span>, </span>
<span>  size <span class="op">=</span> <span class="fl">6</span>, </span>
<span>  prob <span class="op">=</span> <span class="va">probs</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="running-a-single-diffusion">Running a single diffusion<a class="anchor" aria-label="anchor" href="#running-a-single-diffusion"></a>
</h3>
<p>To generate the class, you run</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/network_diffusions.html">network_diffusions</a></span><span class="op">(</span></span>
<span>  <span class="va">edge_data</span>, </span>
<span>  weighted <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  directed <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>For just running a single diffusion from a single set, you can do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diffuse_seed_nodes.html">diffuse_seed_nodes</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>, </span>
<span>  diffusion_vector <span class="op">=</span> <span class="va">diffusion_vector_1</span>, </span>
<span>  summarisation <span class="op">=</span> <span class="st">"max"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Should you have duplicated names in the diffusion vector, the function</span></span>
<span><span class="co"># provides different summarisation methods for the underlying scores</span></span></code></pre></div>
</div>
<p><code>bixverse</code> offers a permutation-based test, using degree matched samplings to calculate Z-scores for each node. This is based on Rust-accelerated, parallelised permutations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/permute_seed_nodes.html">permute_seed_nodes</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>,</span>
<span>  perm_iters <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  .verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>You can access the data via S7 properties</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_diffusion_vector.html">get_diffusion_vector</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span><span class="va">permutation_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_diffusion_perms.html">get_diffusion_perms</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">diffusion_res</span>, xlab <span class="op">=</span> <span class="st">"PPR score"</span>, main <span class="op">=</span> <span class="st">"Diffusion result"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">permutation_res</span>, xlab <span class="op">=</span> <span class="st">"Z score"</span>, main <span class="op">=</span> <span class="st">"Permutation result"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="genetic_diffusions_files/figure-html/access%20the%20data%20in%20the%20class-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can appreciated that there is a tail of values receiving more “diffuion heat” than expected just by topology properties of the network.</p>
</section><section class="level3"><h3 id="assessing-the-recovery-of-gold-standard-genes">Assessing the recovery of gold standard genes<a class="anchor" aria-label="anchor" href="#assessing-the-recovery-of-gold-standard-genes"></a>
</h3>
<p>To assess if the diffusions are useful to start with, you can run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">auc_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_diffusion_auc.html">calculate_diffusion_auc</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>, </span>
<span>  hit_nodes <span class="op">=</span> <span class="va">gold_standard_genes</span>,</span>
<span>  permutation_test <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># This will do permutation and generate Z-scores</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"The AUC of the diffuion is %.3f."</span>, </span>
<span>    <span class="va">auc_results</span><span class="op">$</span><span class="va">auc</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The AUC of the diffuion is 0.589."</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"The Z-score based on random permutations is %.3f."</span>,</span>
<span>    <span class="va">auc_results</span><span class="op">$</span><span class="va">z</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The Z-score based on random permutations is 0.764."</span></span></code></pre></div>
</div>
<p>As this is random data, we observe an AUC of just 0.589 and a corresponding Z-score of 0.764, indicating that the diffusion is not very informative compared to random sets of gold standard genes.</p>
</section><section class="level3"><h3 id="generation-of-communities-with-high-diffusion-heat">Generation of communities with high diffusion heat<a class="anchor" aria-label="anchor" href="#generation-of-communities-with-high-diffusion-heat"></a>
</h3>
<p>We provide function to identify regions in the graph that have higher diffusion heat (for e.g., ‘genetically privileged’ communities akin to <a href="https://pubmed.ncbi.nlm.nih.gov/36823319/" class="external-link">Barrio-Hernandez et al.</a>). We provide two options to return the initial network:</p>
<ul>
<li>Proportion of highest scoring nodes in the network (as in the intial paper).</li>
<li>p-value based, i.e., you need to have run the permutations.</li>
</ul>
<p>Verion 1 is run here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/community_detection.html">community_detection</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>,</span>
<span>  community_params <span class="op">=</span> <span class="fu"><a href="../reference/params_community_detection.html">params_community_detection</a></span><span class="op">(</span></span>
<span>    min_nodes <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>    threshold_type <span class="op">=</span> <span class="st">"prop_based"</span>,</span>
<span>    min_seed_nodes <span class="op">=</span> <span class="fl">1L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_results.html">get_results</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_v1</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cluster_id node_id      ks_pval cluster_size seed_nodes_no diffusion_score</span></span>
<span><span class="co">#&gt;        &lt;char&gt;  &lt;char&gt;        &lt;num&gt;        &lt;int&gt;         &lt;int&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  cluster_1  genes1 0.0002750607           11             1     0.036787391</span></span>
<span><span class="co">#&gt; 2:  cluster_1  genes8 0.0002750607           11             1     0.010320664</span></span>
<span><span class="co">#&gt; 3:  cluster_1 genes20 0.0002750607           11             1     0.009712234</span></span>
<span><span class="co">#&gt; 4:  cluster_1 genes51 0.0002750607           11             1     0.003384912</span></span>
<span><span class="co">#&gt; 5:  cluster_1 genes10 0.0002750607           11             1     0.002746791</span></span>
<span><span class="co">#&gt; 6:  cluster_1 genes22 0.0002750607           11             1     0.003231076</span></span>
<span><span class="co">#&gt;    seed_node</span></span>
<span><span class="co">#&gt;       &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     FALSE</span></span>
<span><span class="co">#&gt; 2:     FALSE</span></span>
<span><span class="co">#&gt; 3:     FALSE</span></span>
<span><span class="co">#&gt; 4:     FALSE</span></span>
<span><span class="co">#&gt; 5:     FALSE</span></span>
<span><span class="co">#&gt; 6:     FALSE</span></span></code></pre></div>
</div>
<p>The ks_pval column here signifies the KS test checking if the community has more heat than the rest of the network. In version 2, this is less relevant, as the network is massively reduced.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/community_detection.html">community_detection</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>,</span>
<span>  community_params <span class="op">=</span> <span class="fu"><a href="../reference/params_community_detection.html">params_community_detection</a></span><span class="op">(</span></span>
<span>    min_nodes <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>    threshold_type <span class="op">=</span> <span class="st">"pval_based"</span>,</span>
<span>    pval_threshold <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    min_seed_nodes <span class="op">=</span> <span class="fl">1L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_results.html">get_results</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_v2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cluster_id node_id     ks_pval cluster_size seed_nodes_no diffusion_score</span></span>
<span><span class="co">#&gt;        &lt;char&gt;  &lt;char&gt;       &lt;num&gt;        &lt;int&gt;         &lt;int&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  cluster_1  genes9 0.003788689            5             1     0.039472785</span></span>
<span><span class="co">#&gt; 2:  cluster_1 genes41 0.003788689            5             1     0.057472209</span></span>
<span><span class="co">#&gt; 3:  cluster_1 genes52 0.003788689            5             1     0.024425689</span></span>
<span><span class="co">#&gt; 4:  cluster_1 genes78 0.003788689            5             1     0.006710373</span></span>
<span><span class="co">#&gt; 5:  cluster_1 genes98 0.003788689            5             1     0.006710373</span></span>
<span><span class="co">#&gt;    seed_node</span></span>
<span><span class="co">#&gt;       &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     FALSE</span></span>
<span><span class="co">#&gt; 2:      TRUE</span></span>
<span><span class="co">#&gt; 3:     FALSE</span></span>
<span><span class="co">#&gt; 4:     FALSE</span></span>
<span><span class="co">#&gt; 5:     FALSE</span></span></code></pre></div>
</div>
<p>We can appreciate, that we identify less clusters in this case (just due to the network being reduced).</p>
</section><section class="level3"><h3 id="tied-diffusions">Tied diffusions<a class="anchor" aria-label="anchor" href="#tied-diffusions"></a>
</h3>
<p>Based on <a href="https://pubmed.ncbi.nlm.nih.gov/23986566/" class="external-link">Paull et al.</a> we provide the optionality to run tied diffusions, i.e., have two separate sets of initial seed genes. In the case of an undirected network, both sets are diffused via the personalised page rank algorithm. In the case, of directed networks one is diffused from the network as is, and the other from a network derived from the transpose of the adjacency matrix, i.e., identifying intersecting nodes between the two sets of genes. To run the algorithm, you can just do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tied_diffusion.html">tied_diffusion</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>, </span>
<span>  diffusion_vector_1 <span class="op">=</span> <span class="va">diffusion_vector_1</span>, </span>
<span>  diffusion_vector_2 <span class="op">=</span> <span class="va">diffusion_vector_2</span>,</span>
<span>  summarisation <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>  score_aggregation <span class="op">=</span> <span class="st">"min"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The score aggregation allows to control how the two diffusion results</span></span>
<span><span class="co"># are combined.</span></span></code></pre></div>
</div>
<p>We also provide permutations here again</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The function will automatically recognise which diffusion was used initially</span></span>
<span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/permute_seed_nodes.html">permute_seed_nodes</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>,</span>
<span>  perm_iters <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  .verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Plotting the two:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_diffusion_vector.html">get_diffusion_vector</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span><span class="va">permutation_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_diffusion_perms.html">get_diffusion_perms</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">diffusion_res</span>, xlab <span class="op">=</span> <span class="st">"Tied PPR score"</span>, main <span class="op">=</span> <span class="st">"Diffusion result (tied)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span></span>
<span>  <span class="va">permutation_res</span>, </span>
<span>  xlab <span class="op">=</span> <span class="st">"Tied PPR score"</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Permutations result (tied)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="genetic_diffusions_files/figure-html/tied%20diffusion%20plot-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>You can again identify diffusion-heat privileged communities with the same methods. The function will automatically identify the type of diffusion you applied before. Let’s do this threshold based:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/community_detection.html">community_detection</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>,</span>
<span>  community_params <span class="op">=</span> <span class="fu"><a href="../reference/params_community_detection.html">params_community_detection</a></span><span class="op">(</span></span>
<span>    min_nodes <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>    threshold_type <span class="op">=</span> <span class="st">"prop_based"</span>,</span>
<span>    min_seed_nodes <span class="op">=</span> <span class="fl">1L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_results.html">get_results</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_v1</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cluster_id node_id      ks_pval cluster_size seed_nodes_1 seed_nodes_2</span></span>
<span><span class="co">#&gt;        &lt;char&gt;  &lt;char&gt;        &lt;num&gt;        &lt;int&gt;        &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:  cluster_1  genes5 1.954153e-07           19            1            1</span></span>
<span><span class="co">#&gt; 2:  cluster_1  genes6 1.954153e-07           19            1            1</span></span>
<span><span class="co">#&gt; 3:  cluster_1 genes12 1.954153e-07           19            1            1</span></span>
<span><span class="co">#&gt; 4:  cluster_1 genes14 1.954153e-07           19            1            1</span></span>
<span><span class="co">#&gt; 5:  cluster_1 genes25 1.954153e-07           19            1            1</span></span>
<span><span class="co">#&gt; 6:  cluster_1 genes29 1.954153e-07           19            1            1</span></span>
<span><span class="co">#&gt;    diffusion_score seed_node_a seed_node_b</span></span>
<span><span class="co">#&gt;              &lt;num&gt;      &lt;lgcl&gt;      &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     0.026642185       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 2:     0.003378515       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 3:     0.006056165       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 4:     0.006708816       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 5:     0.002100994       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 6:     0.001590163       FALSE       FALSE</span></span></code></pre></div>
</div>
<p>Or p-value based:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffusion_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/community_detection.html">community_detection</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">diffusion_obj</span>,</span>
<span>  community_params <span class="op">=</span> <span class="fu"><a href="../reference/params_community_detection.html">params_community_detection</a></span><span class="op">(</span></span>
<span>    min_nodes <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>    threshold_type <span class="op">=</span> <span class="st">"pval_based"</span>,</span>
<span>    pval_threshold <span class="op">=</span> <span class="fl">0.4</span>, <span class="co"># Very high threshold here to identify any communities</span></span>
<span>    min_seed_nodes <span class="op">=</span> <span class="fl">1L</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_results.html">get_results</a></span><span class="op">(</span><span class="va">diffusion_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_v2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cluster_id node_id     ks_pval cluster_size seed_nodes_1 seed_nodes_2</span></span>
<span><span class="co">#&gt;        &lt;char&gt;  &lt;char&gt;       &lt;num&gt;        &lt;int&gt;        &lt;int&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:  cluster_1  genes2 0.005269523           19            1            2</span></span>
<span><span class="co">#&gt; 2:  cluster_1  genes5 0.005269523           19            1            2</span></span>
<span><span class="co">#&gt; 3:  cluster_1 genes17 0.005269523           19            1            2</span></span>
<span><span class="co">#&gt; 4:  cluster_1 genes21 0.005269523           19            1            2</span></span>
<span><span class="co">#&gt; 5:  cluster_1 genes59 0.005269523           19            1            2</span></span>
<span><span class="co">#&gt; 6:  cluster_1 genes87 0.005269523           19            1            2</span></span>
<span><span class="co">#&gt;    diffusion_score seed_node_a seed_node_b</span></span>
<span><span class="co">#&gt;              &lt;num&gt;      &lt;lgcl&gt;      &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt; 1:     0.008902783       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 2:     0.026642185       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 3:     0.004129531        TRUE       FALSE</span></span>
<span><span class="co">#&gt; 4:     0.002532385       FALSE        TRUE</span></span>
<span><span class="co">#&gt; 5:     0.002532385       FALSE       FALSE</span></span>
<span><span class="co">#&gt; 6:     0.002532385       FALSE       FALSE</span></span></code></pre></div>
</div>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregor Lueg.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
