<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bixverse R &lt;&gt; Rust interface • bixverse</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="rust_functions_files/libs/quarto-html/popper.min.js"></script><script src="rust_functions_files/libs/quarto-html/tippy.umd.min.js"></script><link href="rust_functions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rust_functions_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bixverse R &lt;&gt; Rust interface">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bixverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bixverse R &lt;&gt; Rust interface</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="using-the-rust-functions-in-more-general-r-code">Using the Rust functions in more general R code<a class="anchor" aria-label="anchor" href="#using-the-rust-functions-in-more-general-r-code"></a>
</h2>
<p><code>bixverse</code> has a number of R &lt;&gt; Rust functions that might be useful more generally. This vignette is there to explore how to use these functions more general. This vignette will show you to use:</p>
<ul>
<li>Correlations (via <code><a href="../reference/rs_cor.html">rs_cor()</a></code>).</li>
<li>Covariance (via <code><a href="../reference/rs_covariance.html">rs_covariance()</a></code>).</li>
<li>Covariance to correlation (via <code><a href="../reference/rs_cov2cor.html">rs_cov2cor()</a></code>).</li>
<li>Distance calculations (vs <code><a href="../reference/rs_dist.html">rs_dist()</a></code>).</li>
<li>Correlations between two matrices (via <code><a href="../reference/rs_cor2.html">rs_cor2()</a></code>).</li>
<li>Calculate the mutual information between columns (via <code>rs_mutual_information()</code>)</li>
<li>Calculations of set similarities between (via <code><a href="../reference/rs_set_similarity_list.html">rs_set_similarity_list()</a></code> or <code><a href="../reference/rs_set_similarity.html">rs_set_similarity()</a></code>).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bixverse</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This vignette will explore the interfaces in <code>bixverse</code> to underlying Rust code you can leverage to make your code faster. But be careful… Any function with <code>rs_</code> can cause panics when misused.</p>
<section class="level3"><h3 id="correlations-co-variance-and-cosine-distance">Correlations, co-variance, and cosine distance<a class="anchor" aria-label="anchor" href="#correlations-co-variance-and-cosine-distance"></a>
</h3>
<p>A typical thing one uses a lot are correlations, co-variance and cosine distances. Let’s look at how to use <code>bixverse</code> to calculate these.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_rows</span> <span class="op">&lt;-</span> <span class="fl">500L</span></span>
<span><span class="va">no_cols</span> <span class="op">&lt;-</span> <span class="fl">500L</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10101L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">random_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">no_rows</span> <span class="op">*</span> <span class="va">no_cols</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">no_cols</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">no_rows</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level4"><h4 id="pearsons-correlation">Pearson’s correlation<a class="anchor" aria-label="anchor" href="#pearsons-correlation"></a>
</h4>
<p>Let’s look at Pearson’s correlations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_pearsons_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rust_pearsons_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_cor.html">rs_cor</a></span><span class="op">(</span><span class="va">random_data</span>, spearman <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tiny numerical differences do exist</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">r_pearsons_res</span>, <span class="va">rust_pearsons_res</span>, tolerance <span class="op">=</span> <span class="fl">1e-15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Speed differences:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_cor.html">rs_cor</a></span><span class="op">(</span><span class="va">random_data</span>, spearman <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr        min         lq       mean     median         uq       max neval</span></span>
<span><span class="co">#&gt;     r 134.156482 134.301562 134.616602 134.383019 134.467511 140.42392    50</span></span>
<span><span class="co">#&gt;  rust   4.805051   5.588271   7.051022   6.838144   7.695355  13.97967    50</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="spearmans-correlations">Spearman’s correlations<a class="anchor" aria-label="anchor" href="#spearmans-correlations"></a>
</h4>
<p>Let’s look at Spearman’s correlations…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_spearman_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">random_data</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rust_spearman_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_cor.html">rs_cor</a></span><span class="op">(</span><span class="va">random_data</span>, spearman <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tiny numerical differences do exist</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">r_spearman_res</span>, <span class="va">rust_spearman_res</span>, tolerance <span class="op">=</span> <span class="fl">1e-15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Speed differences:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">random_data</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_cor.html">rs_cor</a></span><span class="op">(</span><span class="va">random_data</span>, spearman <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr        min         lq       mean     median         uq       max neval</span></span>
<span><span class="co">#&gt;     r 163.584583 166.800074 170.184723 167.245303 167.718625 246.51576    50</span></span>
<span><span class="co">#&gt;  rust   6.713086   7.084518   7.705888   7.279391   7.816471  13.09406    50</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="covariance">Covariance<a class="anchor" aria-label="anchor" href="#covariance"></a>
</h4>
<p>And covariance calculations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_covar_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rust_covar_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_covariance.html">rs_covariance</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tiny numerical differences do exist</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">r_covar_res</span>, <span class="va">rust_covar_res</span>, tolerance <span class="op">=</span> <span class="fl">1e-15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Speed differences:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_covariance.html">rs_covariance</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr        min         lq       mean     median        uq        max neval</span></span>
<span><span class="co">#&gt;     r 133.928057 134.009217 134.302920 134.116467 134.28161 137.190804    50</span></span>
<span><span class="co">#&gt;  rust   4.168576   4.244787   5.030333   4.933285   5.09428   9.287933    50</span></span></code></pre></div>
</div>
<p>Let’s transform covariance to correlations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_cor_from_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">r_covar_res</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rust_cor_from_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_cov2cor.html">rs_cov2cor</a></span><span class="op">(</span><span class="va">rust_covar_res</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tiny numerical differences do exist</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">r_cor_from_covar</span>, <span class="va">rust_cor_from_covar</span>, tolerance <span class="op">=</span> <span class="fl">1e-15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>How much faster is Rust here? (This is where we observe the least improvement.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">r_covar_res</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_cov2cor.html">rs_cov2cor</a></span><span class="op">(</span><span class="va">rust_covar_res</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;     r 2.093279 2.164923 2.772598 2.179170 2.217992 6.810748    50</span></span>
<span><span class="co">#&gt;  rust 1.330708 1.360665 1.552716 1.425822 1.479586 4.634133    50</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="correlations-between-two-matrices">Correlations between two matrices<a class="anchor" aria-label="anchor" href="#correlations-between-two-matrices"></a>
</h4>
<p>We also provide interface to do correlations between two sets of data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_rows_2</span> <span class="op">&lt;-</span> <span class="fl">500L</span></span>
<span><span class="va">no_cols_2</span> <span class="op">&lt;-</span> <span class="fl">400L</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">23L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">random_data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">no_rows_2</span> <span class="op">*</span> <span class="va">no_cols_2</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">no_cols_2</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">no_rows_2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Let’s test the correlations between the two matrices</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_cor_2_matrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">random_data</span>, <span class="va">random_data_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rust_cor_2_matrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_cor2.html">rs_cor2</a></span><span class="op">(</span><span class="va">random_data</span>, <span class="va">random_data_2</span>, spearman <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The small precision differences are further propagated in here</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">r_cor_2_matrices</span>, <span class="va">rust_cor_2_matrices</span>, tolerance <span class="op">=</span> <span class="fl">1e-14</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>And speed between Rust and R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">random_data</span>, <span class="va">random_data_2</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_cor2.html">rs_cor2</a></span><span class="op">(</span><span class="va">random_data</span>, <span class="va">random_data_2</span>, spearman <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr        min         lq       mean     median         uq       max neval</span></span>
<span><span class="co">#&gt;     r 193.550548 193.694947 193.890195 193.755154 193.910078 197.97824    50</span></span>
<span><span class="co">#&gt;  rust   4.719081   5.304842   5.984014   5.470721   6.473059  12.45936    50</span></span></code></pre></div>
</div>
</section></section><section class="level3"><h3 id="distance-metrics">Distance metrics<a class="anchor" aria-label="anchor" href="#distance-metrics"></a>
</h3>
<p><code>bixverse</code> also includes various distance metrics. Let’s have a look at very common ones.</p>
<section class="level4"><h4 id="euclidean-distance">Euclidean distance<a class="anchor" aria-label="anchor" href="#euclidean-distance"></a>
</h4>
<p>Let’s check out the very classical Euclidean distance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_euclidean_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span></span>
<span>    <span class="va">random_data</span>, </span>
<span>    method <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs_euclidean_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_dist.html">rs_dist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span>, <span class="co"># dist() calculates row-wise distances</span></span>
<span>  distance_type <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">r_euclidean_distance</span>, </span>
<span>  <span class="va">rs_euclidean_distance</span>, </span>
<span>  tolerance <span class="op">=</span> <span class="fl">1e-14</span>,</span>
<span>  check.attributes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Again, Rust is much faster…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to remove any overhead, we do not do the matrix transformation</span></span>
<span><span class="co"># or the transpositation. due to the equal dimensions, it will</span></span>
<span><span class="co"># not matter</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">random_data</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_dist.html">rs_dist</a></span><span class="op">(</span><span class="va">random_data</span>, distance_type <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr       min        lq      mean    median        uq      max neval</span></span>
<span><span class="co">#&gt;     r 95.824323 95.916604 96.107839 96.018353 96.175656 97.25608    50</span></span>
<span><span class="co">#&gt;  rust  4.500945  5.262333  5.851942  5.433703  6.587512 10.29119    50</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="other-distance-metrics">Other distance metrics<a class="anchor" aria-label="anchor" href="#other-distance-metrics"></a>
</h4>
<p>Let’s test other distance metrics…</p>
<p><strong>Manhattan distance</strong></p>
<p>We observe again equivalence of Rust and R results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_manhattan_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span></span>
<span>    <span class="va">random_data</span>, </span>
<span>    method <span class="op">=</span> <span class="st">"manhattan"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs_manhattan_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_dist.html">rs_dist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span>, <span class="co"># dist() calculates row-wise distances</span></span>
<span>  distance_type <span class="op">=</span> <span class="st">"manhattan"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">r_manhattan_distance</span>, </span>
<span>  <span class="va">rs_manhattan_distance</span>, </span>
<span>  tolerance <span class="op">=</span> <span class="fl">1e-14</span>,</span>
<span>  check.attributes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>And speed ups in Rust.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to remove any overhead, we do not do the matrix transformation</span></span>
<span><span class="co"># or the transpositation. due to the equal dimensions, it will</span></span>
<span><span class="co"># not matter</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">random_data</span>, method <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_dist.html">rs_dist</a></span><span class="op">(</span><span class="va">random_data</span>, distance_type <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;     r 88.75771 89.28167 89.82572 89.93952 90.11243 92.15146    50</span></span>
<span><span class="co">#&gt;  rust 17.16589 17.51593 17.74523 17.62233 17.77073 20.49649    50</span></span></code></pre></div>
</div>
<p><strong>Canberra distance</strong></p>
<p>Equivalence observed…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_canberra_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span></span>
<span>    <span class="va">random_data</span>, </span>
<span>    method <span class="op">=</span> <span class="st">"canberra"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rs_canberra_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_dist.html">rs_dist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">random_data</span><span class="op">)</span>, <span class="co"># dist() calculates row-wise distances</span></span>
<span>  distance_type <span class="op">=</span> <span class="st">"canberra"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">r_canberra_distance</span>, </span>
<span>  <span class="va">rs_canberra_distance</span>, </span>
<span>  tolerance <span class="op">=</span> <span class="fl">1e-14</span>,</span>
<span>  check.attributes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>… and speed-ups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to remove any overhead, we do not do the matrix transformation</span></span>
<span><span class="co"># or the transpositation. due to the equal dimensions, it will</span></span>
<span><span class="co"># not matter</span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">random_data</span>, method <span class="op">=</span> <span class="st">"canberra"</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_dist.html">rs_dist</a></span><span class="op">(</span><span class="va">random_data</span>, distance_type <span class="op">=</span> <span class="st">"canberra"</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;  expr       min        lq     mean    median        uq       max neval</span></span>
<span><span class="co">#&gt;     r 134.96480 135.19898 135.5234 135.33733 135.62055 139.07148    50</span></span>
<span><span class="co">#&gt;  rust  45.80183  46.04351  46.2473  46.29644  46.38926  46.74799    50</span></span></code></pre></div>
</div>
</section></section><section class="level3"><h3 id="mutual-information">Mutual information<a class="anchor" aria-label="anchor" href="#mutual-information"></a>
</h3>
<p>Another quantity you might be interested in is the mutual information between between your variables of interest. <code>bixverse</code> also provides a Rust-powered interface into very rapid calculations in this regard.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we are going to create a reduced set for the benchmark to finish </span></span>
<span><span class="co"># in a reasonable time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">246L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nrows</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">ncols</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nrows</span> <span class="op">*</span> <span class="va">ncols</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">nrows</span>, ncol <span class="op">=</span> <span class="va">ncols</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"sample_%i"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nrows</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"feature_%i"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">ncols</span><span class="op">)</span></span></code></pre></div>
</div>
<p>To run the function you can just use the following code. The Rust version will default to sqrt(nrow())</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rust_res_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_mutual_info.html">rs_mutual_info</a></span><span class="op">(</span></span>
<span>  <span class="va">mat</span>, </span>
<span>  n_bins <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"equal_width"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">rust_res_mi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rust_res_mi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ensure that the same discretisation is used</span></span>
<span><span class="va">infotheo_res_mi</span> <span class="op">&lt;-</span> <span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/mutinformation.html" class="external-link">mutinformation</a></span><span class="op">(</span><span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/discretize.html" class="external-link">discretize</a></span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  disc <span class="op">=</span> <span class="st">"equalwidth"</span>,</span>
<span>  nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">rust_res_mi</span>, <span class="va">infotheo_res_mi</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>There is also an equal frequency strategy implemented:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rust_res_mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_mutual_info.html">rs_mutual_info</a></span><span class="op">(</span></span>
<span>  <span class="va">mat</span>, </span>
<span>  n_bins <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"equal_freq"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">rust_res_mi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rust_res_mi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ensure that the same discretisation is used</span></span>
<span><span class="va">infotheo_res_mi</span> <span class="op">&lt;-</span> <span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/mutinformation.html" class="external-link">mutinformation</a></span><span class="op">(</span><span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/discretize.html" class="external-link">discretize</a></span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  disc <span class="op">=</span> <span class="st">"equalfreq"</span>,</span>
<span>  nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">rust_res_mi</span>, <span class="va">infotheo_res_mi</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Again, the Rust implementation is way faster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  infotheo <span class="op">=</span> <span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/mutinformation.html" class="external-link">mutinformation</a></span><span class="op">(</span><span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/discretize.html" class="external-link">discretize</a></span><span class="op">(</span></span>
<span>    <span class="va">mat</span>,</span>
<span>    disc <span class="op">=</span> <span class="st">"equalwidth"</span>,</span>
<span>    nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_mutual_info.html">rs_mutual_info</a></span><span class="op">(</span></span>
<span>    <span class="va">mat</span>, </span>
<span>    n_bins <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    strategy <span class="op">=</span> <span class="st">"equal_width"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr       min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#&gt;  infotheo 82.952222 83.637950 84.145584 83.869381 84.488134 89.364478    50</span></span>
<span><span class="co">#&gt;      rust  3.341575  3.367914  3.519818  3.434573  3.641264  4.441133    50</span></span></code></pre></div>
</div>
<p>And with equal frequency per bin:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  infotheo <span class="op">=</span> <span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/mutinformation.html" class="external-link">mutinformation</a></span><span class="op">(</span><span class="fu">infotheo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/infotheo/man/discretize.html" class="external-link">discretize</a></span><span class="op">(</span></span>
<span>    <span class="va">mat</span>,</span>
<span>    disc <span class="op">=</span> <span class="st">"equalfreq"</span>,</span>
<span>    nbins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  rust <span class="op">=</span> <span class="fu"><a href="../reference/rs_mutual_info.html">rs_mutual_info</a></span><span class="op">(</span></span>
<span>    <span class="va">mat</span>, </span>
<span>    n_bins <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    normalise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    strategy <span class="op">=</span> <span class="st">"equal_freq"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr        min         lq       mean    median         uq       max neval</span></span>
<span><span class="co">#&gt;  infotheo 100.504291 101.608188 101.984481 101.87197 102.149806 105.55219    50</span></span>
<span><span class="co">#&gt;      rust   4.361866   4.408653   4.543785   4.53309   4.646296   5.38826    50</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="set-similarities">Set similarities<a class="anchor" aria-label="anchor" href="#set-similarities"></a>
</h3>
<p><code>bixverse</code> also provides various functions that leverage Rust to do set similarities. Let’s compare this against some R implementation. Below is a naive R implementation to calculate the Jaccard similarities between two lists containing strings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jaccard_sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">random_sets_1</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000L</span>, <span class="op">~</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">random_sets_2</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500L</span>, <span class="op">~</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Let’s start with a naive <a href="https://purrr.tidyverse.org" class="external-link">purrr</a> approach. The problem obviously will benefit from some form of parallel processing, but for completeness, let’s run this version, too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_results</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">random_sets_1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">random_sets_2</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span><span class="fu">jaccard_sim</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  ■■■■                              12% |  ETA: 22s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■                          23% |  ETA: 19s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■■■■■                      35% |  ETA: 16s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■■■■■■■■                   47% |  ETA: 13s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■■■■■■■■■■■■               59% |  ETA: 10s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■■■■■■■■■■■■■■■            71% |  ETA:  7s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■■■■■■■■■■■■■■■■■■■        83% |  ETA:  4s</span></span>
<span><span class="co">#&gt;  ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■    95% |  ETA:  1s</span></span>
<span></span>
<span><span class="va">similarity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">r_results</span><span class="op">)</span>, </span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_1</span><span class="op">)</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_2</span><span class="op">)</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 25.122 sec elapsed</span></span></code></pre></div>
</div>
<p>Let’s try to parallelise this vi <a href="https://furrr.futureverse.org" class="external-link">furrr</a> and evaluate how much we can improve this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">(</span>workers <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_results</span> <span class="op">&lt;-</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">future_map</a></span><span class="op">(</span><span class="va">random_sets_1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">random_sets_2</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span><span class="fu">jaccard_sim</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span>, .progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">similarity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">r_results</span><span class="op">)</span>, </span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_1</span><span class="op">)</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_2</span><span class="op">)</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 13.824 sec elapsed</span></span>
<span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/sequential.html" class="external-link">sequential</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Parallelisation as expected accelerates the calculations substantially. What about <a href="https://mirai.r-lib.org/articles/mirai.html" class="external-link">mirai</a>? It should produce less overhead compared to future.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_results_mirai</span> <span class="op">&lt;-</span> <span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/mirai_map.html" class="external-link">mirai_map</a></span><span class="op">(</span><span class="va">random_sets_1</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">sets_2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">sets_2</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sets_2 <span class="op">=</span> <span class="va">random_sets_2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span>
<span></span>
<span><span class="va">similarity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">r_results_mirai</span><span class="op">)</span>, </span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_1</span><span class="op">)</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_2</span><span class="op">)</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 13.43 sec elapsed</span></span>
<span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<p>That’s already a bit better. Maybe we can optimise the Jaccard similarity function further and accelerate this even more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_results_mirai</span> <span class="op">&lt;-</span> <span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/mirai_map.html" class="external-link">mirai_map</a></span><span class="op">(</span><span class="va">random_sets_1</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">sets_2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">sets_2</span>, \<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Optimised function</span></span>
<span>    <span class="va">intersection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">union_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="va">intersection</span></span>
<span>    <span class="va">intersection</span> <span class="op">/</span> <span class="va">union_size</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span>, .args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sets_2 <span class="op">=</span> <span class="va">random_sets_2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">]</span></span>
<span></span>
<span><span class="va">similarity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">r_results</span><span class="op">)</span>, </span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_1</span><span class="op">)</span>, </span>
<span>  ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">random_sets_2</span><span class="op">)</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mirai</span><span class="fu">::</span><span class="fu"><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">daemons</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 7.976 sec elapsed</span></span></code></pre></div>
</div>
<p>This is already much better… Pending on your system you might be seeing a 4x increase in speed compared to the naive purrr version. However, let’s compare against the Rust version implemented in <code>bixverse</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rust_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_set_similarity_list2.html">rs_set_similarity_list2</a></span><span class="op">(</span></span>
<span>    s_1_list <span class="op">=</span> <span class="va">random_sets_1</span>,</span>
<span>    s_2_list <span class="op">=</span> <span class="va">random_sets_2</span>,</span>
<span>  overlap_coefficient <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0.048 sec elapsed</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">similarity_matrix</span>, <span class="va">rust_res</span>, tolerance <span class="op">=</span> <span class="fl">1e-15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<p>Yep, that is MUCH faster… These are some of the functions that are exposed in <code>bixverse</code> and can be integrated into other workflows. There are many more highly specialised functions that can be used in other workflows. It’s best to explore the package and the underlying code base to identify all of these functions.</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregor Lueg.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
